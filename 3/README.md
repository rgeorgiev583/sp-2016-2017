# `lseek`

Това системно извикване се използва за seek-ване (т.е. отиване на позиция) в отворен файл.


## Синтаксис

	#include <unistd.h>

    off_t lseek(int fd, off_t offset, int whence);


## Семантика

Функцията `lseek` променя позицията на *файловия офсет* (позицията за четене и писане) на отворения файл, описан от файловия дескриптор `fd`.  Като резултат връща новата позиция на офсета или `-1`, ако промяната на офсета не е успяла.  Стойността на аргумента `whence` определя как точно се интерпретира стойността на `offset`:

* `SEEK_SET`: `offset` е относителен спрямо началото на файла (т.е. първия байт, който е на нулева позиция). С други думи на файловия офсет се задава стойност, равна на аргумента `offset`.  В този случай `offset` не може да бъде отрицателен.
**Примери**:
	* `lseek(fd, 0, SEEK_SET)` връща `0` и отива на позицията на първия байт във файла.
	* `lseek(fd, 5, SEEK_SET)` връща `5` и отива на позицията на шестия байт във файла.

* `SEEK_CUR`: `offset` е относителен спрямо текущата позиция във файла.  С други думи на файловия офсет се задава стойност, равна на текущата позиция плюс аргумента `offset`.  `offset` може да бъде отрицателен, при което на файловия офсет се задава като стойност текущата позиция минус съответния брой байтове.
**Примери**:
	* Този код ще зададе като стойност на офсета шестия байт във файла (`5 + 0 == 5`):
			lseek(fd, 5, SEEK_SET)
			lseek(fd, 0, SEEK_CUR)
	* Този код ще зададе като стойност на офсета седмия байт във файла (`5 + 1 == 6`):
			lseek(fd, 5, SEEK_SET)
			lseek(fd, 1, SEEK_CUR)
	* Този код ще зададе като стойност на офсета петия байт във файла (`5 - 1 == 4`):
			lseek(fd, 5, SEEK_SET)
			lseek(fd, -1, SEEK_CUR)

* `SEEK_END`: `offset` е относителен спрямо крайната позиция във файла.  С други думи на файловия офсет се задава стойност, равна на дължината на файла (т.е. позицията след последния байт) плюс аргумента `offset`.  `offset` може да бъде отрицателен, при което на файловия офсет се задава като стойност крайната позиция минус съответния брой байтове.
**Примери**:
	* `lseek(fd, 0, SEEK_END)` отива на позицията след последния байт във файла (на нея може да се пише, но не и да се чете).
	* `lseek(fd, -1, SEEK_END)` отива на позицията на последния байт във файла.
	* `lseek(fd, -5, SEEK_END)` отива на позицията на петия байт от края на файла.

`lseek` сам по себе си не променя дължината на файла.  Все пак, ако чрез него бъде зададен офсет след края на файла, при последващо писане от този офсет позициите от края на файла до офсета ще бъдат запълнени с нулеви байтове (т.е. байтове със стойност `0`).  Това може да се види във втория пример:

* **Пример 1.**

		$ echo 'bar baz' > foo  # добавя нов ред след `bar baz`
        $ cat foo
        bar baz
        $ make write-ate
        cc -pedantic -Wall -O3 write-ate.c -o write-ate
        $ ./write-ate foo quux
        $ cat foo
        bar baz
        quux
        $ xxd foo
        00000000: 6261 7220 6261 7a0a 7175 7578            bar baz.quux

* **Пример 2.**

		$ echo 'bar baz' > foo  # добавя нов ред след `bar baz`
        $ cat foo
        bar baz
        $ make write-ate-var
        cc -pedantic -Wall -O3 write-ate-var.c -o write-ate-var
        $ ./write-ate-var foo quux 5
        $ cat foo
        bar baz
        quux
        $ xxd foo
        00000000: 6261 7220 6261 7a0a 0000 0000 0071 7575  bar baz......quu
		00000010: 78                                       x
